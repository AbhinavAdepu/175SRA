/* html5-preloader (lite) http://code.google.com/p/html5-preloader */
if(typeof Array.prototype.inArray!="function"){Array.prototype.inArray=function(b){for(var a=0;a<this.length;a++){if(this[a]===b){return true}}return false}}function html5Preloader(){var g=this,j=[],v=[],t=[],b=[],o=[],e=[],m,d,s,r,u,n,a,w,q,k=["jpg","png","apng","tiff","svg","jpeg","pnga","gif"];this.addFiles=function(){var z,y,D,A,G,x,C,B,F,E=[];for(z=0;z<arguments.length;z++){E=[];D=arguments[z].split("*:");A=D[0];G=D[D.length-1].split("||");for(y=0;y<G.length;y++){x=G[y].split(".");x=x[x.length-1].toLowerCase();C=p(x);if(C!="unsupported"){E.push({datatype:C,filepath:G[y]})}}if(F=E.shift()){v.push({identifier:A,datatype:F.datatype,filepath:F.filepath,alternates:E})}}if(v.length>0){B=g.active;g.active=true;if(!B){g.loadSequence()}}};this.loadSequence=function(){if(v.length<1){g.active=false;g.filesLoaded=0;g.nowLoading="";return g.onfinish()}cf=v.shift();if(!g.removeFile(cf.identifier)){g.filesLoaded++}g.nowLoading=cf.identifier;if(cf.datatype=="audio"){return l(cf)}if(cf.datatype=="video"){return h(cf)}if(cf.datatype=="image"){return c(cf)}if(cf.datatype=="document"){return f(cf)}};function p(i){if(t.inArray(i)){return"audio"}if(b.inArray(i)){return"video"}if(o.inArray(i)||e.inArray(i)){return"unsupported"}if(k.inArray(i)){return"image"}return"document"}function l(y){var i,x;try{i=new Audio()}catch(z){i=document.createElement("audio")}i.src=y.filepath;x=g;i.addEventListener("canplaythrough",function(){x.loadSequence()},true);i.onerror=function(A){x.triggerError(A)};j.push({identifier:y.identifier,filepath:y.filepath,datatype:y.datatype,alternates:y.alternates,data:i});i.load()}function h(y){var i,x;try{i=new Video()}catch(z){i=document.createElement("video")}i.src=y.filepath;x=g;i.addEventListener("canplaythrough",function(){x.loadSequence()},true);i.onerror=function(A){x.triggerError(A)};j.push({identifier:y.identifier,filepath:y.filepath,datatype:y.datatype,alternates:y.alternates,data:i});i.load()}function c(y){var x=new Image(),i=g;x.src=y.filepath;x.onload=function(){i.loadSequence()};x.onerror=function(z){i.triggerError(z)};j.push({identifier:y.identifier,filepath:y.filepath,datatype:y.datatype,alternates:y.alternates,data:x})}function f(y){j.push({identifier:y.identifier,filepath:y.filepath,datatype:y.datatype,alternates:y.alternates,data:false});if(!jQuery||!jQuery.ajax){return g.loadSequence}var i=g,x=j[j.length-1];jQuery.ajax({url:y.filepath,data:{rnduux:Math.random()},cache:false,success:function(z){x.data=z;i.loadSequence()},error:function(A,z,B){i.triggerError([A,z,B])}})}this.triggerError=function(A){var y,x,z;for(y=0;y<j.length;y++){if(j[y].identifier==g.nowLoading){x=j[y];break}}if(x.alternates.length>0){z=x.alternates.shift();x.filepath=z.filepath;x.datatype=z.datatype;v.unshift(x);g.removeFile(g.nowLoading);return g.loadSequence()}if(this.active&&this.onerror(A)){g.loadSequence()}};this.getProgress=function(){return g.filesLoaded/(g.filesLoaded+v.length)};this.getFile=function(y){for(var x=0;x<j.length;x++){if(j[x].identifier==y){return j[x].data}}};this.removeFile=function(y){for(var x=0;x<j.length;x++){if(j[x].identifier==y){return j.splice(x,1)}}return false};m=!!(document.createElement("audio").canPlayType);d=["audio/mpeg","audio/ogg"];s=[["mp3"],["ogg"]];r=!!(document.createElement("video").canPlayType);u=["video/mp4","video/ogg","video/divx"];n=[["mp4","mpeg","mpg"],["ogv","oga"],["dvx","divx","xdiv"]];if(m){a=document.createElement("audio");for(q=0;q<d.length;q++){if("no"!=a.canPlayType(d[q])&&""!=a.canPlayType(d[q])){t=t.concat(s[q])}else{o=o.concat(s[q])}}}if(r){w=document.createElement("video");for(q=0;q<u.length;q++){if("no"!=w.canPlayType(u[q])&&""!=w.canPlayType(u[q])){b=b.concat(n[q])}else{e=e.concat(n[q])}}}this.addFiles.apply(this,arguments)}html5Preloader.prototype={active:false,filesLoaded:0,nowLoading:"",version:0.52,onfinish:function(){},onerror:function(a){return true}};html5Preloader.prototype.version=0.53;
